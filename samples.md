# 構成の例
## 1. 単一サーバー
基本的なもの。webもアプリもDBも同居する状態

## 2. DBだけ独立
単一サーバーからDBを独立させたもの。

### 分離するメリット
* Webサーバーとデータベース(DB)サーバーを分ける理由はいくつかありますが、主に以下の点が挙げられます：
* セキュリティ強化：WebサーバーとDBサーバーを物理的または論理的に分離することで、セキュリティリスクを低減できます。万一Webサーバーが攻撃された場合でも、DBサーバーが直接攻撃されるリスクを減らすことができます。
* パフォーマンスの最適化：WebサーバーとDBサーバーは異なる種類のリソース（CPU、メモリ、ストレージ）を要求します。これらを分けることで、それぞれのサーバーをその用途に最適化し、全体的なパフォーマンスを向上させることができます。
* スケーラビリティの向上：需要に応じて、WebサーバーとDBサーバーを個別にスケーリングすることができます。たとえば、ユーザーのアクセスが増加した場合、Webサーバーの数を増やすことで対応できます。
* メンテナンスとアップデートの容易さ：WebサーバーとDBサーバーが分かれていると、一方をメンテナンスやアップデートする際に、もう一方に影響を与えにくくなります。
* 障害隔離：一方のサーバーに問題が発生しても、他のサーバーには影響が少なくなります。これにより、システム全体の信頼性が向上します。
* データ管理の簡素化：DBサーバーを分離することで、データのバックアップやリカバリをより効率的に行うことが可能になります。

### 3. サーバーを増やす
ロードバランサーを設置してサーバーを増やす
DBは共有

### 4. DBを増やす
書き込みはマスターのDBと別に読み取り専用のDBを設置する。
読み取りDBへはレプリケーションでデータを同期する。

ここからは応答時間の改善
### 5. キャッシュの利用
#### 考慮すること
キャッシュをいつ使用するかを決定します。
データが頻繁に読み取られるが、変更されることはほとんどない場合は、キャッシュの使用を検討してください。キャッシュされたデータは揮発性メモリに保存されるため、キャッシュ サーバーはデータを永続化するのには理想的ではありません。たとえば、キャッシュ サーバーが再起動すると、メモリ内のすべてのデータが失われます。
したがって、重要なデータは永続的なデータ ストアに保存する必要があります。

有効期限ポリシー。
有効期限ポリシーを実装することをお勧めします。キャッシュされたデータの有効期限が切れると、キャッシュから削除されます。
有効期限ポリシーがない場合、キャッシュされたデータはメモリに永続的に保存されます。
システムがデータベースからデータを頻繁にリロードする原因となるため、有効期限を短くしすぎないことをお勧めします。
一方、データが古くなってしまう可能性があるため、有効期限を長すぎないことをお勧めします。

一貫性: 
これには、データ ストアとキャッシュの同期を維持することが含まれます。
データ ストアとキャッシュに対するデータ変更操作が単一のトランザクション内にないため、不整合が発生する可能性があります。
複数のリージョンにまたがってスケーリングする場合、データ ストアとキャッシュの間の一貫性を維持するのは困難です。
詳細については、Facebook が公開した「Scaling Memcache at Facebook」というタイトルの論文を参照してください [7]。

障害の軽減: 
単一のキャッシュ サーバーは、潜在的な単一障害点 (SPOF) を表します。
ウィキペディアでは次のように定義されています。「単一障害点 (SPOF) はシステムの一部であり、障害が発生するとシステム全体が停止します。
仕事から」[8]。そのため、SPOF を回避するには、異なるデータセンターにまたがる複数のキャッシュ サーバーを使用することをお勧めします。
もう 1 つの推奨されるアプローチは、必要なメモリを特定の割合でオーバープロビジョニングすることです。
これにより、メモリ使用量が増加したときにバッファが提供されます。

### CDNの導入
パフォーマンス向上：CDNはコンテンツのキャッシュや最適化を通じて、ウェブページのロード時間を短縮し、ユーザーエクスペリエンスを向上させます。

トラフィックの急増に対応：プロモーションやイベントによるトラフィックの急増に対応するためにCDNを利用することができます。

セキュリティ強化：CDNはDDoS攻撃などのセキュリティリスクに対する追加の防御層を提供します。

コンテンツの種類：静的コンテンツ（画像、CSS、JavaScriptファイルなど）を多く扱う場合、CDNを利用することで効率的に配信できます。

帯域幅コストの削減：CDNは帯域幅使用量を減らすことができ、ホスティングコストの削減に寄与することがあります。

スケーラビリティ：サービスの成長に伴い、将来的にトラフィックが増加する可能性がある場合、CDNはスケールアップの準備として役立ちます。

ここからはサーバーの水平スケーリング
### スティッキーセッション
サーバーを増やすことを考える。
サーバーのセッションを利用する場合、常に同じサーバーを参照する必要がある。
スティッキーセッションはそれを実現できる。問題は、同じクライアントからのすべてのリクエストを同じサーバーにルーティングする必要があることです。
これは、ほとんどのロード バランサのスティッキー セッションで実行できます [10]。
ただし、これによりオーバーヘッドが追加されます。このアプローチでは、サーバーの追加または削除がはるかに困難になります。サーバー障害に対処することも困難です。

### ステートレスWeb
主にセッションなどを外部DBなどを使って管理する。こうすることでサーバーのスケーリングなどが可能になる。
セキュリティには注意
1. セッションデータの暗号化
クライアントに保存されるセッションデータ（例えば、Cookie）は、第三者による読み取りや改ざんを防ぐために暗号化する必要があります。
HTTPSを使用して、クライアントとサーバー間の全ての通信を暗号化します。
2. セッション固定攻撃の防止
セッションIDは、ユーザーがログインするたびに変更する必要があります。これにより、セッション固定攻撃（Session Fixation）を防ぐことができます。
3. セッションハイジャックのリスク軽減
セッションハイジャックを防ぐために、セッションIDの盗用を防ぐ措置が必要です。これには、セッションIDの頻繁な更新や、短いセッション有効期間の設定が含まれます。
クライアントのIPアドレスやユーザーエージェントのような属性を確認して、セッションの正当性を検証することも有効です。
4. Cookieのセキュリティ属性の設定
CookieにSecure属性を設定して、CookieのデータがHTTPSを介してのみ送信されるようにします。
HttpOnly属性を設定して、JavaScriptを通じたCookieのアクセスを防ぎます。
SameSite属性を適切に設定することで、クロスサイトリクエストフォージェリ（CSRF）攻撃のリスクを軽減できます。
5. クロスサイトリクエストフォージェリ（CSRF）対策
CSRFトークンを使用して、フォーム送信などの重要な操作に対する認証を行います。
6. セッションストアのセキュリティ
セッションデータを外部のストア（例：Redis、データベース）に保存する場合、そのストアのセキュリティを確保する必要があります。
7. セッションの有効期限
セッションには適切な有効期限を設定し、古いセッションを定期的に破棄します。
8. エンドユーザーへの教育
ユーザーに対して、安全なパスワードの使用、ログアウト後のブラウザの閉じ方、公共のWi-Fi環境でのセキュリティリスクなどについて教育することも重要です。
これらの対策は、ステートレスWeb環境におけるセッション管理のセキュリティを確保するための基本的なガイドラインです。セキュリティは常に進化する分野であるため、最新の脅威と対策について常に情報を更新し、適切な対応を行うことが重要です。

### シャーディング
レコードの分割については記載がなかったので後日やる。




